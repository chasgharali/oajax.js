var ref_cache="",ref_request="",$off_ajax=$.ajax;!function(e){var a=e.ajax;e.ajax=function(t){if(t.data){var r=JSON.stringify(t.data);ref_cache="cache@"+t.url+"%"+r,ref_request="request@"+t.url+"%"+r}else ref_cache="cache@"+t.url,ref_request="request@"+t.url;if(t.error){var c=t.success,o=t.context?t.context:e;t.error=function(e){if(JSON.parse('{ "error" : 404 }'),null===localStorage.getItem(ref_cache)){if(null===localStorage.getItem(ref_request)){var a=JSON.stringify(t);window.localStorage.setItem(ref_request,a),sync_que=oajax.getQue(),sync_que.push(ref_request),window.localStorage.setItem("sync_que",JSON.stringify(sync_que))}}else{oajax.logMsg&&console.log("getting data offline");var r=localStorage.getItem(ref_cache);oajax.parseResult?JSON.parse(r):r}c.apply(o,arguments)}}if(t.success){var s=t.success,n=t.context?t.context:e;t.success=function(e){window.localStorage.setItem(ref_cache,JSON.stringify(e)),oajax.logMsg&&console.log("getting data online"),s.apply(n,arguments)}}a.apply(e,arguments)}}(jQuery);var $oajax=$.ajax,oajax={parseResult:!0,logMsg:!0,getQue:function(){if(null===localStorage.getItem("sync_que"))return window.localStorage.setItem("sync_que",JSON.stringify([])),[];var e=localStorage.getItem("sync_que");return JSON.parse(e)},queHandle:function(){sync_que=oajax.getQue();for(var e=0;e<sync_que.length;++e)oajax.syncData(sync_que[e],function(a){console.log(a),"success"==a&&sync_que.splice(e,1)});window.localStorage.setItem("sync_que",JSON.stringify(sync_que))},syncData:function(e,a){var t=JSON.parse(localStorage.getItem(e));if(t.data){var r=JSON.stringify(t.data);ref_cache="cache@"+t.url+"%"+r}else ref_cache="cache@"+t.url;t.async=!1,t.success=function(r){window.localStorage.setItem(ref_cache,JSON.stringify(r)),oajax.logMsg&&console.log(e+": "+t.url+" sync with server"),localStorage.removeItem(e),a("success")},t.error=function(e,t,r){a("error")},$off_ajax(t)}};$(document).ready(function(){window.setInterval(function(){oajax.queHandle()},1e4)});