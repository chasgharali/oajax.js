var oajax={logMsg:0,request:function(e,t,n,a,o){$.ajax({type:e,url:t,data:JSON.stringify(n),contentType:a,success:function(e){window.localStorage.setItem("cache@"+t+"%"+JSON.stringify(n),JSON.stringify(e)),oajax.logMsg&&console.log("getting data online"),o(e)},error:function(c,r,s){if(null===localStorage.getItem("cache@"+t+"%"+JSON.stringify(n))){var l="request@"+t+"%"+JSON.stringify(n);if(null===localStorage.getItem(l)){var i={type:e,url:t,data:JSON.stringify(n),contentType:a};window.localStorage.setItem(l,JSON.stringify(i)),sync_que=oajax.getQue(),sync_que.push(l),window.localStorage.setItem("sync_que",JSON.stringify(sync_que)),o('{"error" : "404"}')}else o('{"error" : "404"}')}else oajax.logMsg&&console.log("getting data offline"),o(localStorage.getItem("cache@"+t+"%"+JSON.stringify(n)))}})},getQue:function(){if(null===localStorage.getItem("sync_que"))return window.localStorage.setItem("sync_que",JSON.stringify([])),[];var e=localStorage.getItem("sync_que");return JSON.parse(e)},queHandle:function(){sync_que=oajax.getQue();for(var e=0;e<sync_que.length;++e)oajax.syncData(sync_que[e],function(t){"success"==t&&sync_que.splice(e,1)});window.localStorage.setItem("sync_que",JSON.stringify(sync_que))},syncData:function(e,t){var n=JSON.parse(localStorage.getItem(e));$.ajax({type:n.type,async:!1,url:n.url,data:n.data,contentType:n.contentType,success:function(a){window.localStorage.setItem("cache@"+n.url+"%"+n.data,JSON.stringify(a)),oajax.logMsg&&console.log(e+": "+n.url+" sync with server"),localStorage.removeItem(e),t("success")},error:function(e,n,a){t("error")}})}};$(document).ready(function(){window.setInterval(function(){oajax.queHandle()},1e4)});